!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("TokenHandlerAssistant",[],t):"object"==typeof exports?exports.TokenHandlerAssistant=t():e.TokenHandlerAssistant=t()}(self,(()=>(()=>{"use strict";var e={943:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthAgentClient=void 0;const o=n(613);t.OAuthAgentClient=class{constructor(e){this.oauthAgentBaseUrl=e.oauthAgentBaseUrl.endsWith("/")?e.oauthAgentBaseUrl:`${e.oauthAgentBaseUrl}/`}refresh(){return r(this,void 0,void 0,(function*(){return{accessTokenExpiresIn:(yield this.fetch("POST","refresh")).access_token_expires_in}}))}session(){return r(this,void 0,void 0,(function*(){const e=yield this.fetch("GET","session");return{isLoggedIn:e.is_logged_in,idTokenClaims:e.id_token_claims,accessTokenExpiresIn:e.access_token_expires_in}}))}startLogin(e){return r(this,void 0,void 0,(function*(){const t=this.toUrlSearchParams(null==e?void 0:e.extraAuthorizationParameters);return{authorizationUrl:(yield this.fetch("POST","login/start",void 0,t)).authorization_url}}))}endLogin(e){return r(this,void 0,void 0,(function*(){const t=yield this.fetch("POST","login/end",void 0,e.searchParams);return{isLoggedIn:t.isLoggedIn,csrfToken:t.csrf,idTokenClaims:t.id_token_claims,accessTokenExpiresIn:t.access_token_expires_in}}))}logout(e){return r(this,void 0,void 0,(function*(){return{logoutUrl:(yield this.fetch("POST","logout",e)).logout_url}}))}onPageLoad(e){return r(this,void 0,void 0,(function*(){const t=new URL(e);return this.isOAuthResponse(t)?yield this.endLogin({searchParams:t.searchParams}):yield this.session()}))}isOAuthResponse(e){const t=e.searchParams,n=t.has("state")&&t.has("code"),r=t.has("response")&&1==Array.from(t).length,o=t.has("error")&&t.has("state");return n||r||o}toUrlSearchParams(e){return e?new URLSearchParams(e):new URLSearchParams}fetch(e,t,n,s){return r(this,void 0,void 0,(function*(){const r={accept:"application/json","token-handler-version":"1"};if("login/start"!=t&&"login/end"!=t||(r["content-type"]="application/x-www-form-urlencoded"),n){const e=n.split("=");r[e[0]]=e[1]}const i={credentials:"include",headers:r,method:e,mode:"cors"};null!=s&&(i.body=s);const a=yield window.fetch(`${this.oauthAgentBaseUrl}${t}`,i);if(a.ok)return yield a.json();if("application/json"==a.headers.get("content-type")){const e=yield a.json();throw new o.OAuthAgentRemoteError(a.status,e.error_code,e.detailed_error)}throw new o.OAuthAgentRemoteError(a.status,"server_error",a.statusText)}))}}},613:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthAgentRemoteError=void 0;class n extends Error{constructor(e,t,n){super(`${e}: ${t}`),this.status=e,this.code=t,this.details=n}}t.OAuthAgentRemoteError=n}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.OAuthAgentClient=e.OAuthAgentRemoteError=void 0;var t=n(613);Object.defineProperty(e,"OAuthAgentRemoteError",{enumerable:!0,get:function(){return t.OAuthAgentRemoteError}});var o=n(943);Object.defineProperty(e,"OAuthAgentClient",{enumerable:!0,get:function(){return o.OAuthAgentClient}})})(),r})()));